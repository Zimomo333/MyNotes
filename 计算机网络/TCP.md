## TCP三次握手

![](C:\zimomo\File\Notes\面试\picture\tcp三次握手.jpg)

起初，服务和客户端都为CLOSED状态。

**第一次握手** 
客户端向服务端发送连接请求报文段。该报文段的头部中SYN=1，ACK=0，seq=x。请求发送后，客户端便进入SYN-SENT状态。

- SYN=1，ACK=0表示该报文段为连接请求报文。
- x为本次TCP通信的字节流的初始序号。 
  TCP规定：SYN=1的报文段不能有数据部分，但要消耗掉一个序号。

**第二次握手** 
服务端收到连接请求报文段后，如果同意连接，则会发送一个应答：SYN=1，ACK=1，seq=y，ack=x+1。 
该应答发送完成后便进入SYN-RCVD状态。

- SYN=1，ACK=1表示该报文段为连接同意的应答报文。
- seq=y表示服务端作为发送者时，发送字节流的初始序号。
- ack=x+1表示服务端希望下一个数据报发送序号从x+1开始的字节。

**第三次握手** 
当客户端收到连接同意的应答后，还要向服务端发送一个确认报文段，表示：服务端发来的连接同意应答已经成功收到。 
该报文段的头部为：ACK=1，seq=x+1，ack=y+1。 
客户端发完这个报文段后便进入ESTABLISHED状态，服务端收到这个应答后也进入ESTABLISHED状态，此时连接的建立完成！



### 为什么连接建立需要三次握手，而不是两次握手？





双方要连接，要等待对端同意并返回确认，一端请求后收到确认包就意味着，网络可达并且对端同意建立连接。

A--请求-->B

A<--确认--B

A<--请求--B

A--确认-->B

中间两次可以一起返回，所以是三次

